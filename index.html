<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QiuQiu Chip Simulator</title>

<!-- Telegram WebApp -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #1b1b1b, #000);
  color: #fff;
  text-align: center;
}
.container {
  max-width: 420px;
  margin: auto;
  padding: 20px;
}
.card {
  background: #111;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 0 20px rgba(255,215,0,.15);
}
h1 { color: gold; margin-bottom: 5px; }
.user { font-size: 13px; color: #aaa; }
.rank { font-weight: bold; color: #00eaff; }
.chip { font-size: 26px; color: gold; margin: 10px 0; }
button {
  width: 100%;
  padding: 14px;
  margin: 8px 0;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}
.play { background: gold; }
.daily { background: #00eaff; }
.reset { background: #ff4d4d; }
.anim {
  font-size: 22px;
  height: 30px;
  margin: 10px 0;
}
.leaderboard {
  margin-top: 15px;
  text-align: left;
  font-size: 14px;
}
.online {
  font-size: 13px;
  color: #0f0;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h1>QiuQiu</h1>
    <div class="user" id="user"></div>
    <div class="rank" id="rank"></div>
    <div class="chip" id="chip"></div>

    <div class="anim" id="anim"></div>

    <button class="play" onclick="play()">üé≤ Play</button>
    <button class="daily" onclick="daily()">üéÅ Daily Reward</button>
    <button class="reset" onclick="resetSeason()">üîÑ Reset Season</button>

    <div class="leaderboard">
      <b>üèÜ Leaderboard</b>
      <ol id="lb"></ol>
    </div>

    <div class="online" id="online"></div>
  </div>
</div>

<!-- Monetag Rewarded Interstitial -->
<script src="//libtl.com/sdk.js"
  data-zone="10564685"
  data-sdk="show_10564685">
</script>

<script>
/* ===============================
   TELEGRAM USER
================================ */
const tg = window.Telegram.WebApp;
tg.ready();

const user = tg.initDataUnsafe?.user;
const userId = user?.id || "guest";
const username = user?.username || user?.first_name || "Guest";

document.getElementById("user").innerText = "üë§ " + username;

/* ===============================
   STORAGE KEY PER USER
================================ */
const chipKey = "chip_" + userId;
const dailyKey = "daily_" + userId;

let chip = localStorage.getItem(chipKey)
  ? parseInt(localStorage.getItem(chipKey))
  : 1000;

let lastDaily = localStorage.getItem(dailyKey) || 0;

/* ===============================
   HELPER
================================ */
function rankName(c){
  if(c < 5000) return "Bronze";
  if(c < 15000) return "Silver";
  if(c < 50000) return "Gold";
  if(c < 150000) return "Platinum";
  return "Diamond";
}

function update(){
  document.getElementById("chip").innerText = "Chip: " + chip.toLocaleString();
  document.getElementById("rank").innerText = "Rank: " + rankName(chip);
  localStorage.setItem(chipKey, chip);
}

/* ===============================
   MONETAG REWARDED
================================ */
function showRewardedAd(onSuccess){
  if (typeof window.show_10564685 === "function") {
    show_10564685()
      .then(() => { onSuccess(); })
      .catch(() => {
        alert("Iklan gagal dimuat, coba lagi.");
      });
  } else {
    alert("Ads belum siap.");
  }
}

/* ===============================
   GAME LOGIC
================================ */
function play(){
  let win = Math.random() > 0.5;
  let anim = document.getElementById("anim");

  if(win){
    let gain = Math.floor(Math.random()*500)+200;
    chip += gain;
    anim.innerText = "üéâ WIN +" + gain;
    anim.style.color = "#0f0";
  } else {
    let lose = Math.floor(Math.random()*300)+100;
    chip -= lose;
    if(chip < 0) chip = 0;
    anim.innerText = "üíÄ LOSE -" + lose;
    anim.style.color = "#f00";
  }
  update();
}

function daily(){
  let now = Date.now();
  if(now - lastDaily < 86400000){
    alert("Daily reward sudah diambil!");
    return;
  }

  showRewardedAd(() => {
    chip += 2000;
    lastDaily = now;
    localStorage.setItem(dailyKey, now);
    update();
    alert("üéÅ +2000 Chip!");
  });
}

function resetSeason(){
  if(confirm("Reset chip kamu?")){
    showRewardedAd(() => {
      chip = 1000;
      localStorage.removeItem(chipKey);
      localStorage.removeItem(dailyKey);
      update();
      alert("Season berhasil di-reset!");
    });
  }
}

/* ===============================
   FAKE DATA
================================ */
function fakeOnline(){
  document.getElementById("online").innerText =
    "üü¢ Online: " + (Math.floor(Math.random()*900)+1000);
}

function leaderboard(){
  let lb = document.getElementById("lb");
  lb.innerHTML = "";
  for(let i=1;i<=5;i++){
    let li = document.createElement("li");
    li.innerText = "Player" + i + " - " +
      (chip + Math.floor(Math.random()*5000)).toLocaleString();
    lb.appendChild(li);
  }
}

setInterval(fakeOnline, 2000);
setInterval(leaderboard, 3000);

update();
</script>

</body>
</html>
